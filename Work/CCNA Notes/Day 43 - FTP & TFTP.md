---
tags:
  - work
  - ccna
---
- ## FTP & TFTP Intro
	- FTP (File Transfer Protocol) and TFTP (Trivial File Transfer Protocol) are industry standard protocols used to transfer files over a network
	- They both use a client-server modal
		- Clients can use FTP or TFTP to copy files from/to a server
	- As a network engineer, the most common use for FTP/TFTP is in the process of upgrading the operating system of a network device
		- You can use FTP/TFTP to download the newer version of IOS from a server, and then reboot the device with the new IOS image
- ## Trivial File Transfer Protocol ^ccna-tftp
	- TFTP was first standardized in 1981
	- Named 'Trivial' because it is simple and has only basic features compared to FTP
		- Only allows a client to copy a file to or from a server
	- Was released after FTP, but is not a replacement for FTP, it is another tool to use when lightweight simplicity is more important than functionality
	- No authentication, so servers will respond to all TFTP requests
	- No encryption, so all data in sent in plain text
	- Best used in a controlled environment to transfer small files quickly
	- FTFP servers listen on **UDP port 69**
	- UDP is connectionless and doesn't provide reliability with retransmissions
		- However, TFTP has similar built-in features within the protocol itself
	- ### TFTP Reliability
		- Every TFTP data message is acknowledged
			- If the client is transferring a file to the server, the server will send ACK messages
			- If the server is transferring a file to the client, the client will send ACK messages
		- Timers are used, and if an expected message isn't received in time, the waiting device will re-send its previous message
		- TFTP uses 'lock-step' communication, the client and server alternately send a message and then wait for a reply (+retransmissions are sent as needed)
	- ### TFTP Connections
		- TFTP file transfers have three phases:
			1. **Connection**: TFTP client sends a request to the server, and the server responds back, initializing the connection
			2. **Data Transfer**: The client and server exchange TFTP messages, one sends data and the other sends acknowledgments
			3. **Connection Termination**: After the last data message has been sent, a final acknowledgment is sent to terminate the connection
	- ### TFTP TID
		- When the client sends the first message to the server, the destination port is UDP 69 and the source is a random ephemeral port
		- This random port is called a 'Transfer Identifier' (TID) and identifies the data transfer
		- The server then also selects a random TID to use as the source port when it replies, **not 69**
		- When the client sends the next message, the destination port will be the server's TID, **not 69**
- ## File Transfer Protocol
	- FTP was first standardized in 1971
	- FTP uses **TCP ports 20 and 21**
	- Usernames and passwords are used for authentication, however there is no encryption
	- For greater security, FTPS (FTP over SSL/TLS) can be used
	- SSH File Transfer Protocol (SFTP) can also be used for greater security
	- The client sends FTP commands to the server to perform these functions
	- FTP uses two types of connections:
		- An **FTP control** connection (**TCP 21**) is established and used to send FTP commands and replies
		- When files or data are to be transferred, separate FTP data (**TCP 20**) connections are established and terminated as needed
	- ### FTP Control Connections
		1. The client initiates the TCP connection (The usual SYN, SYN ACK, ACK exchange is used)
		2. The control connection is established, and ready to be used to send FTP commands to the server
	- ### FTP Data Connections
		- #### Active Mode
			- The default method of establishing FTP data connections is active mode, in which the **server initiates the TCP connection**
		- #### Passive Mode
			- In FTP passive mode, the client initiates the data connection
			- This is often necessary when the client is behind a firewall, which could block the incoming connection from the server
- ## FTP vs TFTP
	- ### FTP
		- Uses TCP (20 for data, 21 for control) for connection-based communication
		- Clients can use FTP commands to perform various actions, not just copy files
		- Username/PW authentication
		- More complex
	- ### TFTP
		- Uses UDP (69) for connectionless communication (although a basic form of 'connection' is used within the protocol itself)
		- Clients can only copy files to or from the server
		- No authentication
		- Simpler
- ## IOS File Systems
	- A file system is a way of controlling how data is stored and retrieved
	- `show file systems` command allows you to view the file systems of a Cisco IOS device
		- Types:
			- disk: Storage devices such as flash memory
				- IOS operating system is stored here
			- opaque: Used for internal functions
			- nvram: Internal NVRAM
				- The startup-config file is stored here
			- network: Represents external file systems
				- External FTP/TFTP servers
- ## Upgrading Cisco IOS
	- `show flash` command allows you to view the contents of flash
	- ### Copying Files (TFTP)
		- `copy tftp: flash:` command initiates the TFTP copy to flash
			- You will be asked to then enter the TFTP server IP
			- Then enter the source file name
				- You must know this beforehand
			- Then you must enter the name to save the file as
	- ### Copying Files (FTP)
		- `ip ftp username *username*` and `ip ftp password *password*` commands will configure what username and password the device will use when connecting over ftp
		- `copy ftp: flash:` command initiates the FTP copy to flash
	- `boot system *filepath*` command will tell the router which version of IOS to use on boot
		- Be sure to save the configuration before rebooting
	- `reload` command reboots the device
	- `delete flash:*old-ios-filename*` command will delete the old version of IOS